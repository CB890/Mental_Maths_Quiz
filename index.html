<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year 4 Mental Maths Quiz</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #6fb3b8;
            --accent: #f9bc60;
            --background: #f2f7ff;
            --text: #2b2c34;
            --correct: #6bab90;
            --incorrect: #e56b6f;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            width: 90%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.2rem;
            margin-top: 0;
        }
        
        h2 {
            color: var(--primary);
            font-size: 1.8rem;
        }
        
        p {
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .character-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        
        .character {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--secondary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .character:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .character.selected {
            box-shadow: 0 0 0 4px var(--accent);
        }
        
        .character svg {
            width: 60px;
            height: 60px;
            margin-bottom: 5px;
        }
        
        .character-name {
            font-size: 1rem;
            font-weight: bold;
            color: white;
        }
        
        .start-btn, .replay-btn, .next-btn, .submit-btn, .restart-btn {
            background-color: var(--accent);
            color: var(--text);
            font-size: 1.2rem;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        .start-btn:hover, .replay-btn:hover, .next-btn:hover, .submit-btn:hover, .restart-btn:hover {
            background-color: #f8a830;
        }
        
        .quiz-screen {
            display: none;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e1e5ee;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary);
            border-radius: 10px;
            width: 0%;
            transition: width 0.4s;
        }
        
        .question-container {
            margin: 40px 0;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .question {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .answer-container {
            margin-top: 30px;
        }
        
        .answer-input {
            font-size: 1.5rem;
            padding: 10px 15px;
            width: 120px;
            text-align: center;
            border: 3px solid var(--primary);
            border-radius: 10px;
        }
        
        .timer-container {
            margin-top: 20px;
            font-size: 1.2rem;
        }
        
        .timer {
            font-weight: bold;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .audio-controls {
            margin-top: 20px;
        }
        
        .replay-btn {
            padding: 8px 20px;
            font-size: 1rem;
        }
        
        .score-container {
            position: absolute;
            top: 30px;
            right: 30px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .score {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .results-screen {
            display: none;
        }
        
        .results-title {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        .results-message {
            font-size: 1.3rem;
            margin-bottom: 30px;
        }
        
        .results-list {
            text-align: left;
            margin: 0 auto;
            width: fit-content;
            font-size: 1.2rem;
        }
        
        .result-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .result-question {
            margin-right: 15px;
            font-weight: bold;
        }
        
        .result-answer {
            margin-right: 15px;
        }
        
        .result-icon {
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        .result-correct {
            color: var(--correct);
        }
        
        .result-incorrect {
            color: var(--incorrect);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .selected-character {
            display: flex;
            align-items: center;
        }
        
        .selected-character svg {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        .plays-left {
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            p {
                font-size: 1rem;
            }
            
            .question {
                font-size: 1.5rem;
            }
            
            .character {
                width: 100px;
                height: 100px;
            }
            
            .score-container {
                width: 50px;
                height: 50px;
                top: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="container welcome-screen" id="welcomeScreen">
        <h1>Year 4 Mental Maths Quiz</h1>
        <p>Welcome to the Mental Maths Quiz! Listen carefully to each question. <br>
           The question will be read twice before the timer starts.<br>
           You'll have 10 seconds to type your answer.</p>
        
        <h2>Choose your character:</h2>
        <div class="character-selection">
            <div class="character" data-character="robot">
                <svg viewBox="0 0 24 24" fill="white">
                    <path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z" />
                </svg>
                <span class="character-name">Robot</span>
            </div>
            <div class="character" data-character="astronaut">
                <svg viewBox="0 0 24 24" fill="white">
                    <path d="M12,2A9,9 0 0,0 3,11C3,14.03 4.53,16.82 7,18.47V22H9V19H11V22H13V19H15V22H17V18.46C19.47,16.81 21,14 21,11A9,9 0 0,0 12,2M8,11A2,2 0 0,1 10,13A2,2 0 0,1 8,15A2,2 0 0,1 6,13A2,2 0 0,1 8,11M16,11A2,2 0 0,1 18,13A2,2 0 0,1 16,15A2,2 0 0,1 14,13A2,2 0 0,1 16,11M12,14L13.5,17H10.5L12,14Z" />
                </svg>
                <span class="character-name">Astronaut</span>
            </div>
            <div class="character" data-character="scientist">
                <svg viewBox="0 0 24 24" fill="white">
                    <path d="M5,19A1,1 0 0,0 6,20H18A1,1 0 0,0 19,19C19,18.79 18.93,18.59 18.82,18.43L13,8.35V4H11V8.35L5.18,18.43C5.07,18.59 5,18.79 5,19M6,22A3,3 0 0,1 3,19C3,18.4 3.18,17.84 3.5,17.37L9,7.81V6A1,1 0 0,1 8,5V4A2,2 0 0,1 10,2H14A2,2 0 0,1 16,4V5A1,1 0 0,1 15,6V7.81L20.5,17.37C20.82,17.84 21,18.4 21,19A3,3 0 0,1 18,22H6M13,16L14.34,14.66L16.27,18H7.73L10.34,13.27L13,16M12.5,13A0.5,0.5 0 0,1 13,12.5A0.5,0.5 0 0,1 13.5,13A0.5,0.5 0 0,1 13,13.5A0.5,0.5 0 0,1 12.5,13Z" />
                </svg>
                <span class="character-name">Scientist</span>
            </div>
            <div class="character" data-character="athlete">
                <svg viewBox="0 0 24 24" fill="white">
                    <path d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M15.9,8.1C15.5,7.7 14.8,7 13.5,7H10.5C9.2,7 8.5,7.7 8.1,8.1C7.7,8.5 7.5,9 7.5,9.5V14.2L9,15V20L12,21L15,20V15L16.5,14.2V9.5C16.5,9 16.3,8.5 15.9,8.1M12,11C11.4,11 11,10.6 11,10C11,9.4 11.4,9 12,9C12.6,9 13,9.4 13,10C13,10.6 12.6,11 12,11Z" />
                </svg>
                <span class="character-name">Athlete</span>
            </div>
        </div>
        
        <button class="start-btn" id="startBtn" disabled>Start Quiz</button>
    </div>
    
    <!-- Quiz Screen -->
    <div class="container quiz-screen" id="quizScreen">
        <div class="header">
            <div class="selected-character" id="selectedCharacter">
                <!-- Character icon will be shown here -->
            </div>
            <div class="score-container">
                <span>Score</span>
                <span class="score" id="score">0</span>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        
        <h2>Question <span id="currentQuestion">1</span> of 8</h2>
        
        <div class="question-container">
            <div class="question" id="question"></div>
        </div>
        
        <div class="audio-controls">
            <button class="replay-btn" id="replayBtn">Listen Again</button>
            <div class="plays-left" id="playsLeft">2 plays left</div>
        </div>
        
        <div class="timer-container">
            Time remaining: <span class="timer" id="timer">10</span> seconds
        </div>
        
        <div class="answer-container">
            <input type="text" class="answer-input" id="answerInput" disabled>
        </div>
        
        <button class="submit-btn" id="submitBtn" disabled>Submit Answer</button>
    </div>
    
    <!-- Results Screen -->
    <div class="container results-screen" id="resultsScreen">
        <h1 class="results-title">Quiz Complete!</h1>
        <div class="results-message" id="resultsMessage"></div>
        
        <div class="results-list" id="resultsList">
            <!-- Results will be shown here -->
        </div>
        
        <button class="restart-btn" id="restartBtn">Play Again</button>
    </div>

    <script>
        // Quiz Questions and Answers
        const questions = [
            { question: "What is 15 plus 7?", answer: "22" },
            { question: "What is half of 36?", answer: "18" },
            { question: "What is 7 times 6?", answer: "42" },
            { question: "What is 100 minus 45?", answer: "55" },
            { question: "What is double 23?", answer: "46" },
            { question: "What is 56 divided by 8?", answer: "7" },
            { question: "What is 3 more than 29?", answer: "32" },
            { question: "What is 1 less than 50?", answer: "49" }
        ];
        
        // DOM Elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const startBtn = document.getElementById('startBtn');
        const replayBtn = document.getElementById('replayBtn');
        const submitBtn = document.getElementById('submitBtn');
        const restartBtn = document.getElementById('restartBtn');
        const characters = document.querySelectorAll('.character');
        const selectedCharacterDiv = document.getElementById('selectedCharacter');
        const questionElement = document.getElementById('question');
        const currentQuestionElement = document.getElementById('currentQuestion');
        const progressBar = document.getElementById('progress');
        const answerInput = document.getElementById('answerInput');
        const timerElement = document.getElementById('timer');
        const scoreElement = document.getElementById('score');
        const resultsMessage = document.getElementById('resultsMessage');
        const resultsList = document.getElementById('resultsList');
        const playsLeftElement = document.getElementById('playsLeft');
        
        // Quiz State
        let currentQuestionIndex = 0;
        let score = 0;
        let timerInterval;
        let secondsLeft = 10;
        let selectedCharacter = null;
        let speechSynthesis = window.speechSynthesis;
        let speechUtterance = new SpeechSynthesisUtterance();
        let readings = 0;
        let playsLeft = 2;
        let answers = [];
        let isSpeaking = false;
        let isTimerRunning = false;
        
        // Initialize
        function init() {
            // Character Selection
            characters.forEach(character => {
                character.addEventListener('click', () => {
                    characters.forEach(c => c.classList.remove('selected'));
                    character.classList.add('selected');
                    selectedCharacter = character.getAttribute('data-character');
                    selectedCharacterDiv.innerHTML = character.innerHTML;
                    startBtn.disabled = false;
                });
            });
            
            // Configure Speech Synthesis
            setupSpeech();
            
            // Event Listeners
            startBtn.addEventListener('click', startQuiz);
            replayBtn.addEventListener('click', replayQuestion);
            submitBtn.addEventListener('click', submitAnswer);
            answerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitAnswer();
                }
            });
            restartBtn.addEventListener('click', resetQuiz);
        }
        
        // Set up speech synthesis
        function setupSpeech() {
            speechUtterance.rate = 0.9;
            speechUtterance.pitch = 1;
            
            // Try to set British female voice
            let voices = speechSynthesis.getVoices();
            
            // If voices aren't loaded, wait for them
            if (voices.length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    voices = speechSynthesis.getVoices();
                    selectBritishFemaleVoice(voices);
                });
            } else {
                selectBritishFemaleVoice(voices);
            }
        }
        
        // Select British female voice if available
        function selectBritishFemaleVoice(voices) {
            // Preferred voices in order
            const preferredVoices = [
                'Google UK English Female',
                'en-GB-female',
                'en-GB',
                'English United Kingdom'
            ];
            
            // Try to find a preferred voice
            let selectedVoice = null;
            
            for (const preferred of preferredVoices) {
                const foundVoice = voices.find(voice => 
                    voice.name.includes(preferred) || 
                    voice.lang.includes(preferred)
                );
                
                if (foundVoice) {
                    selectedVoice = foundVoice;
                    break;
                }
            }
            
            // If no preferred voice found, try to find any English voice
            if (!selectedVoice) {
                selectedVoice = voices.find(voice => 
                    voice.lang.startsWith('en')
                );
            }
            
            // If still no voice, use the default
            if (selectedVoice) {
                speechUtterance.voice = selectedVoice;
            }
        }
        
        // Start the Quiz
        function startQuiz() {
            welcomeScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            loadQuestion();
        }
        
        // Load a question
        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }
            
            // Reset state for new question
            secondsLeft = 10;
            readings = 0;
            playsLeft = 2;
            isSpeaking = false;
            isTimerRunning = false;
            
            // Update UI
            answerInput.value = '';
            answerInput.disabled = true;
            submitBtn.disabled = true;
            timerElement.textContent = secondsLeft;
            currentQuestionElement.textContent = currentQuestionIndex + 1;
            progressBar.style.width = `${(currentQuestionIndex / questions.length) * 100}%`;
            playsLeftElement.textContent = `${playsLeft} plays left`;
            
            // Set question text
            const currentQuestion = questions[currentQuestionIndex];
            questionElement.textContent = currentQuestion.question;
            
            // Read question aloud twice before starting timer
            readQuestionAloud();
        }
        
        // Read the question aloud
        function readQuestionAloud() {
            isSpeaking = true;
            replayBtn.disabled = true;
            
            // Cancel any ongoing speech
            speechSynthesis.cancel();
            
            // Set the question text
            speechUtterance.text = questions[currentQuestionIndex].question;
            
            // First reading
            speechSynthesis.speak(speechUtterance);
            
            // After first reading completes
            speechUtterance.onend = function() {
                readings++;
                
                if (readings === 1) {
                    // Short pause between readings
                    setTimeout(() => {
                        // Second reading
                        speechSynthesis.speak(speechUtterance);
                    }, 1000);
                } else if (readings === 2) {
                    // After second reading, start timer and enable input
                    isSpeaking = false;
                    replayBtn.disabled = false;
                    startTimer();
                    answerInput.disabled = false;
                    answerInput.focus();
                    submitBtn.disabled = false;
                }
            };
        }
        
        // Replay the question audio (limited to 2 additional plays)
        function replayQuestion() {
            if (playsLeft > 0 && !isSpeaking && !isTimerRunning) {
                playsLeft--;
                playsLeftElement.textContent = `${playsLeft} plays left`;
                
                if (playsLeft === 0) {
                    replayBtn.disabled = true;
                }
                
                // Reset readings counter for this replay
                readings = 0;
                readQuestionAloud();
            }
        }
        
        // Start the timer
        function startTimer() {
            isTimerRunning = true;
            timerInterval = setInterval(() => {
                secondsLeft--;
                timerElement.textContent = secondsLeft;
                
                if (secondsLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }
        
        // Time's up - move to next question
        function timeUp() {
            isTimerRunning = false;
            
            // Record the answer (or lack thereof)
            const currentQuestion = questions[currentQuestionIndex];
            answers.push({
                question: currentQuestion.question,
                correctAnswer: currentQuestion.answer,
                userAnswer: answerInput.value,
                correct: answerInput.value === currentQuestion.answer
            });
            
            // Move to next question
            currentQuestionIndex++;
            loadQuestion();
        }
        
        // Submit answer
        function submitAnswer() {
            if (answerInput.disabled || isSpeaking) return;
            
            clearInterval(timerInterval);
            isTimerRunning = false;
            
            const currentQuestion = questions[currentQuestionIndex];
            const userAnswer = answerInput.value.trim();
            const isCorrect = userAnswer === currentQuestion.answer;
            
            // Record answer
            answers.push({
                question: currentQuestion.question,
                correctAnswer: currentQuestion.answer,
                userAnswer: userAnswer,
                correct: isCorrect
            });
            
            // Update score
            if (isCorrect) {
                score++;
                scoreElement.textContent = score;
            }
            
            // Move to next question
            currentQuestionIndex++;
            loadQuestion();
        }
        
        // Show results
        function showResults() {
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
            
            // Calculate percentage
            const percentage = Math.round((score / questions.length) * 100);
            
            // Display appropriate message based on score
            let message;
            if (percentage >= 90) {
                message = "Amazing work! You're a maths superstar!";
            } else if (percentage >= 70) {
                message = "Great job! You're really good at mental maths!";
            } else if (percentage >= 50) {
                message = "Well done! You're making good progress with your mental maths!";
            } else {
                message = "Good try! Keep practising your mental maths skills!";
            }
            
            resultsMessage.textContent = `You scored ${score} out of ${questions.length} (${percentage}%). ${message}`;
            
            // Display results list
            resultsList.innerHTML = '';
            answers.forEach((answer, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                resultItem.innerHTML = `
                    <span class="result-question">${index + 1}. ${answer.question}</span>
                    <span class="result-answer">Your answer: ${answer.userAnswer || '(no answer)'}</span>
                    <span class="result-answer">Correct answer: ${answer.correctAnswer}</span>
                    <span class="result-icon ${answer.correct ? 'result-correct' : 'result-incorrect'}">
                        ${answer.correct ? '✓' : '✗'}
                    </span>
                `;
                
                resultsList.appendChild(resultItem);
            });
        }
        
        // Reset Quiz
        function resetQuiz() {
            // Reset all state variables
            currentQuestionIndex = 0;
            score = 0;
            answers = [];
            
            // Reset UI
            scoreElement.textContent = score;
            
            // Show welcome screen
            resultsScreen.style.display = 'none';
            welcomeScreen.style.display = 'flex';
        }
        
        // Initialize the quiz
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
